<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Simulator 2026 (Ultimate Control Edition)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #1a1a1a;
            color: #0f0;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        canvas {
            border: 4px solid #333;
            background: #000;
            cursor: none;
            display: none;
        }
        #ui, #level-ui {
            margin-bottom: 10px;
            text-align: center;
            display: none;
        }
        #menu {
            text-align: center;
            background: #333;
            padding: 30px;
            border: 2px solid #0f0;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }
        button {
            background: #000;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1.2em;
        }
        button:hover {
            background: #0f0;
            color: #000;
        }
        #crash-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0000aa;
            color: white;
            padding: 50px;
            box-sizing: border-box;
            z-index: 100;
        }
        .error-code { font-size: 2em; font-weight: bold; }
        .highlight { color: #fff; font-weight: bold; }
        #mode-indicator {
            font-weight: bold;
            padding: 2px 5px;
            background: #040;
        }
        .chaos {
            color: #f00 !important;
            background: #400 !important;
            animation: blink 0.2s infinite;
        }
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="menu">
        <h1>BUG SIMULATOR v4.0</h1>
        <p>System Status: <span style="color: #0f0;">STABLE (mostly)</span></p>
        <p style="font-size: 0.8em;">Now with <s>Broken</s> Mouse Support!</p>
        <button onclick="startGame()">INITIALIZE SYSTEM</button>
    </div>

    <div id="level-ui">
        <h2 id="level-banner">LEVEL 1: HELLO_WORLD</h2>
    </div>

    <div id="ui">
        <div>MODE: <span id="mode-indicator">STABLE</span> | LEVEL: <span id="level-val" class="highlight">1</span></div>
        <div>SCORE: <span id="score" class="highlight">0</span> / 5 | STABILITY: <span id="stability" class="highlight">100%</span></div>
        <div id="status">System: Tracking input...</div>
    </div>

    <canvas id="gameCanvas" width="600" height="400"></canvas>

    <div id="crash-screen">
        <p class="error-code">:(</p>
        <p>Your Bug Simulator ran into a problem and needs to restart. </p>
        <p id="crash-percent">0% complete</p>
        <p>Stop Code: <span id="stop-code">MOUSE_DRIVER_FAULT</span><br>What failed: hid_generic.sys</p>
        <button onclick="location.reload()">REBOOT SYSTEM</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const stabilityEl = document.getElementById('stability');
        const statusEl = document.getElementById('status');
        const levelEl = document.getElementById('level-val');
        const levelBanner = document.getElementById('level-banner');
        const modeEl = document.getElementById('mode-indicator');
        const crashScreen = document.getElementById('crash-screen');
        const menu = document.getElementById('menu');
        const ui = document.getElementById('ui');
        const levelUi = document.getElementById('level-ui');

        let score = 0;
        let level = 1;
        let stability = 100;
        let gameActive = false;
        let currentMode = 'easy';

        const configs = {
            easy: {
                name: "STABLE",
                inputIgnore: 0.02,
                mouseLag: 0.15, // Lower is more lag (interpolation factor)
                mouseOffsetRange: 0,
                invertChance: 0.005,
                driftChance: 0.002,
                scoreReset: 0.01,
                drainRate: 0.005,
                crashChance: 0.0001
            },
            hard: {
                name: "CHAOS",
                inputIgnore: 0.25,
                mouseLag: 0.03, // SUPER heavy lag
                mouseOffsetRange: 100, // Character follows mouse from far away
                invertChance: 0.12,
                driftChance: 0.10,
                scoreReset: 0.20,
                drainRate: 0.04,
                crashChance: 0.005
            }
        };

        const player = { x: 300, y: 200, size: 20, speed: 5, color: '#0f0' };
        const food = { x: 100, y: 100, size: 15 };
        const keys = {};
        const mouse = { x: 300, y: 200, actualX: 300, actualY: 200 };
        let mouseStuck = false;

        function startGame() {
            menu.style.display = 'none';
            canvas.style.display = 'block';
            ui.style.display = 'block';
            levelUi.style.display = 'block';
            gameActive = true;
            resetFood();
            setInterval(checkModeToggle, 4000); 
            loop();
        }

        function checkModeToggle() {
            if (!gameActive) return;
            if (Math.random() < 0.3) {
                if (currentMode === 'easy') setMode('hard');
                else setMode('easy');
            }
        }

        function setMode(mode) {
            currentMode = mode;
            modeEl.innerText = configs[mode].name;
            if (mode === 'hard') {
                modeEl.classList.add('chaos');
                canvas.style.borderColor = '#f00';
                statusEl.innerText = "System: MOUSE_ACCELERATION_ERR";
            } else {
                modeEl.classList.remove('chaos');
                canvas.style.borderColor = '#333';
                statusEl.innerText = "System: Driver calibrated";
            }
        }

        // --- INPUT HANDLERS ---
        window.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            if (Math.random() < configs[currentMode].inputIgnore) return;
            keys[e.key.toLowerCase()] = true;
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!gameActive) return;
            
            // BUG: 10% chance for mouse to "freeze" for a moment
            if (Math.random() < 0.1 && !mouseStuck) {
                mouseStuck = true;
                statusEl.innerText = "System: HID polling failure";
                setTimeout(() => mouseStuck = false, 500);
            }

            if (!mouseStuck) {
                const rect = canvas.getBoundingClientRect();
                mouse.actualX = e.clientX - rect.left;
                mouse.actualY = e.clientY - rect.top;
            }
        });

        function resetFood() {
            food.x = 50 + Math.random() * (canvas.width - 100);
            food.y = 50 + Math.random() * (canvas.height - 100);
        }

        function triggerCrash() {
            gameActive = false;
            crashScreen.style.display = 'block';
            let p = 0;
            const interval = setInterval(() => {
                p += Math.floor(Math.random() * 10);
                if (p > 100) p = 100;
                document.getElementById('crash-percent').innerText = p + "% complete";
                if (p === 100) clearInterval(interval);
            }, 300);
        }

        function nextLevel() {
            level++;
            score = 0;
            levelEl.innerText = level;
            scoreEl.innerText = score;
            const titles = ["", "DRIVERS_LOADED", "INPUT_LAG_PRO", "GHOST_POINTER", "BLUE_SCREEN_READY", "ALMOST_PLAYABLE"];
            levelBanner.innerText = `LEVEL ${level}: ${titles[level] || "ERR_IO"}`;
            configs.hard.mouseLag *= 0.8; // More lag every level
            statusEl.innerText = "System: Patch applied (v" + level + ".0)";
            stability = Math.min(100, stability + 20);
        }

        function update() {
            if (!gameActive) return;

            const cfg = configs[currentMode];
            let targetX = mouse.actualX;
            let targetY = mouse.actualY;

            // BUG: Mouse Inversion (in Chaos mode)
            if (currentMode === 'hard' && Math.random() < 0.05) {
                targetX = canvas.width - targetX;
                targetY = canvas.height - targetY;
                statusEl.innerText = "System: Coordinate system overflow";
            }

            // BUG: Random Offset
            if (Math.random() < 0.05) {
                mouse.x += (Math.random() - 0.5) * cfg.mouseOffsetRange;
                mouse.y += (Math.random() - 0.5) * cfg.mouseOffsetRange;
            }

            // Smoothly move towards target (with lag)
            player.x += (targetX - player.x) * cfg.mouseLag;
            player.y += (targetY - player.y) * cfg.mouseLag;

            // Still support WASD but with massive drift
            if (keys['w']) player.y -= player.speed;
            if (keys['s']) player.y += player.speed;
            if (keys['a']) player.x -= player.speed;
            if (keys['d']) player.x += player.speed;

            // BUG: Drift
            if (Math.random() < cfg.driftChance) {
                player.x += (Math.random() - 0.5) * 60;
                player.y += (Math.random() - 0.5) * 60;
                statusEl.innerText = "System: Surface friction = 0";
            }

            // Bounds
            if (player.x < 0) player.x = 0;
            if (player.y < 0) player.y = 0;
            if (player.x > canvas.width - player.size) player.x = canvas.width - player.size;
            if (player.y > canvas.height - player.size) player.y = canvas.height - player.size;

            // Collision
            if (player.x < food.x + food.size && player.x + player.size > food.x &&
                player.y < food.y + food.size && player.y + player.size > food.y) {
                
                score++;
                if (Math.random() < cfg.scoreReset) {
                    score = 0;
                    statusEl.innerText = "System: Transaction rolled back";
                }
                scoreEl.innerText = score;
                resetFood();
                if (score >= 5) nextLevel();
            }

            stability -= cfg.drainRate;
            stabilityEl.innerText = Math.max(0, Math.floor(stability)) + "%";

            if (stability <= 0 || Math.random() < cfg.crashChance) triggerCrash();

            // Visual Screen Shake
            if (currentMode === 'hard' && Math.random() < 0.1) {
                ctx.translate((Math.random()-0.5)*15, (Math.random()-0.5)*15);
            }
        }

        function draw() {
            ctx.fillStyle = currentMode === 'hard' ? "rgba(40,0,0,0.5)" : "rgba(0,0,0,0.3)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Food
            ctx.fillStyle = '#f00';
            ctx.fillRect(food.x, food.y, food.size, food.size);
            ctx.fillStyle = '#fff';
            ctx.fillText("BUG", food.x, food.y - 5);

            // Player
            ctx.fillStyle = player.color;
            if (currentMode === 'hard' && Math.random() < 0.3) ctx.fillStyle = '#f0f';
            ctx.fillRect(player.x, player.y, player.size, player.size);
            
            // Draw a "Fake" Cursor that jumps around
            if (currentMode === 'hard') {
                ctx.strokeStyle = '#fff';
                ctx.strokeRect(mouse.actualX + (Math.random()-0.5)*50, mouse.actualY + (Math.random()-0.5)*50, 5, 5);
            }
        }

        function loop() {
            if (!gameActive) return;
            update();
            draw();
            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
